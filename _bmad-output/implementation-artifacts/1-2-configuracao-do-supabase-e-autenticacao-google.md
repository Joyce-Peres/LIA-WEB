<!-- Generated by create-story (manual run) -->
# Story 1.2: Configuração do Supabase e Autenticação Google

Status: in-progress

## Story

As a developer,
I want to configure Supabase project with Google authentication and create the profiles table,
so that users can authenticate and their profile data can be stored securely.

## Acceptance Criteria

1. **Given** I have a Supabase project created  
   **When** I configure Google OAuth authentication  
   **Then** Google authentication should be enabled in Supabase Auth settings  
   **And** The profiles table should be created with schema: id (uuid, FK to auth.users), email, display_name, total_xp (default 0), current_streak (default 0), avatar_url, created_at  
   **And** Row Level Security (RLS) should be enabled on profiles table  
   **And** Policies should be created: "Usuários podem ver todos os perfis" (SELECT) and "Usuários podem editar apenas seu perfil" (UPDATE)  
   **And** Environment variables VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY should be configured

## Tasks / Subtasks

- [x] Task 1: Supabase schema (profiles + RLS) (AC: 1)
  - [x] Add a SQL file in the repo containing profiles table + RLS policies (aligned to `docs/architeture.md#4.2`) (`supabase/sql/01_profiles.sql`)
  - [x] Ensure SQL is idempotent where possible (extension creation, table creation guards, drop/create policy)

- [x] Task 2: Supabase client (frontend) (AC: 1)
  - [x] Install `@supabase/supabase-js`
  - [x] Create `src/lib/supabase.ts` exporting a configured `supabase` client
  - [x] Validate required env vars at startup and fail fast with a clear error message (`src/lib/env.ts`)
  - [x] Add TypeScript env typing in `src/vite-env.d.ts`

- [ ] Task 3: Supabase project configuration (manual, required to satisfy AC) (AC: 1)
  - [x] Create `docs/supabase-setup.md` with step-by-step setup
  - [ ] Enable Google provider in Supabase Auth settings (requires Google Client ID/Secret)
  - [ ] Apply `supabase/sql/01_profiles.sql` in Supabase SQL Editor
  - [ ] Configure local env vars (`.env` or `.env.local`) with `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`

## Dev Notes

### Relevant architecture patterns and constraints

- **Backend/BaaS**: Supabase (PostgreSQL + Auth + Storage), no custom Node backend.  
- **Security**: RLS enabled on `profiles`, with public read and owner update policies.  
- **Env vars**: Use Vite env (`import.meta.env`) keys `VITE_SUPABASE_URL` and `VITE_SUPABASE_ANON_KEY`.  

### Source tree components to touch

- `package.json` (add `@supabase/supabase-js`)
- `src/lib/supabase.ts` (Supabase client)
- `src/lib/env.ts` (env validation helper)
- `src/vite-env.d.ts` (env typing)
- `docs/supabase-setup.md` (manual setup guide)
- `supabase/sql/01_profiles.sql` (schema + RLS)

### Testing standards summary

- No tests required in this story (setup + wiring). Validation is via:
  - `npm run build`
  - `npm run lint`
  - `npx tsc --noEmit`

### References

- `docs/architeture.md#4.2` (SQL inicial: profiles + RLS policies)
- `docs/architeture.md#6.2` (env vars)
- `_bmad-output/epics.md#Story 1.2` (ACs)

## Dev Agent Record

### Agent Model Used

Auto (Cursor AI Agent)

### Debug Log References

N/A

### Completion Notes List

- ✅ SQL file created for `profiles` + RLS (`supabase/sql/01_profiles.sql`)
- ✅ Supabase JS client configured (`src/lib/supabase.ts`)
- ✅ Env validation helper added (`src/lib/env.ts`)
- ✅ Vite env typing updated (`src/vite-env.d.ts`)
- ✅ Supabase setup guide added (`docs/supabase-setup.md`)
- ⚠️ Manual steps still required to satisfy AC: enable Google provider + apply SQL + set env vars locally (see `docs/supabase-setup.md`)

## Senior Developer Review (AI)

**Review Date:** 2025-12-21  
**Review Outcome:** ❌ CHANGES REQUESTED

### Findings (Adversarial)

**HIGH**
1. **AC not verifiable from repo**: AC requires Google provider enabled and profiles table created in Supabase. Repo contains code + SQL + docs, but cannot prove the Supabase dashboard configuration was executed. Marking Task 3 as completed would be misleading.

**MEDIUM**
2. **Git/story audit weak due to untracked baseline**: `git status --porcelain` shows most of the repo as `??` (untracked), making story-level diffs unreliable until the initial baseline commit exists.
3. **Setup doc needed more specificity**: `docs/supabase-setup.md` should explicitly describe Google Cloud + Supabase redirect/callback URLs and where to set them.

### Required actions

- Complete Task 3 (manual) using `docs/supabase-setup.md`.
- After manual completion, move story to `review` again and run `*code-review` (dev agent) to mark `done`.

### File List

- package.json
- package-lock.json
- src/lib/env.ts
- src/lib/supabase.ts
- src/vite-env.d.ts
- supabase/sql/01_profiles.sql
- docs/supabase-setup.md

