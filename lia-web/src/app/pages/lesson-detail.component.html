<div class="lesson-page" *ngIf="!isLoading(); else loadingTpl">
  <div class="header">
    <button class="btn ghost" (click)="backToModule()">‚Üê Voltar</button>
    <div class="spacer"></div>
    <app-user-menu></app-user-menu>
  </div>

  <div class="head">
    <h1 class="title">{{ lesson()?.displayName }}</h1>
    <p class="module-link">M√≥dulo: {{ lesson()?.module?.title }}</p>
  </div>

  <div class="meta">
    <span class="badge badge-neutral">Gesto: {{ lesson()?.gestureName }}</span>
    <span class="badge badge-neutral">N√≠vel {{ lesson()?.level }}</span>
    <span class="badge badge-success">XP {{ lesson()?.xpReward }}</span>
  </div>

  <div class="video-section soft-card soft-card--spacious">
    <h2 class="section-title"><span class="icon-emoji md">üìπ</span> Demonstra√ß√£o</h2>
    <app-gesture-video-player
      [src]="lesson()?.videoRefUrl"
      [gesture]="lesson()?.gestureName"
      [loopVideo]="true"
      [autoplayVideo]="false"
    ></app-gesture-video-player>
  </div>

  <div class="instructions soft-card soft-card--spacious">
    <h2 class="section-title"><span class="icon-emoji md">üìù</span> Instru√ß√µes</h2>
    <p class="instruction-text">
      1. Assista ao v√≠deo acima para aprender o gesto <em>{{ lesson()?.gestureName }}</em><br>
      2. Clique em "Praticar agora" para usar sua c√¢mera<br>
      3. Reproduza o gesto at√© atingir {{ (lesson()?.minConfidenceThreshold ?? 0.7) * 100 }}% de confian√ßa<br>
      4. Complete 5 repeti√ß√µes corretas para concluir a li√ß√£o
    </p>
  </div>

  <div class="actions">
    <button class="btn primary" (click)="practice()">Praticar agora</button>
    @if (nextLesson()) {
      <button class="btn" (click)="goToNextLesson()">Pr√≥xima li√ß√£o: {{ nextLesson()?.displayName }}</button>
    }
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading">Carregando‚Ä¶</div>
</ng-template>
